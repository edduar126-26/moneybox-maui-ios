<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Money_Box.Views.TablaAmortizacionPrestamo"
             BackgroundColor="#FAFAFA">
    <ContentPage.Resources>
        <ResourceDictionary>
            <Style x:Key="btnDark" TargetType="Button">
                <Setter Property="BackgroundColor" Value="#42424c"/>
                <Setter Property="WidthRequest" Value="200"/>
                <Setter Property="TextColor" Value="#FFFFFF"/>
                <Setter Property="VerticalOptions" Value="Center"/>
                <Setter Property="HorizontalOptions" Value="Center"/>
                <Setter Property="CornerRadius" Value="8"/>
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <NavigationPage.TitleView>
        <StackLayout Orientation="Horizontal">
            <Image Margin="10" HeightRequest="30" Source="LogoMoneybox" HorizontalOptions="Start"/>
            <Label Text="{Binding NombreSocio}" VerticalOptions="Center" Margin="10,10" FontSize="16" FontAttributes="Bold" TextColor="Black"/>
        </StackLayout>
    </NavigationPage.TitleView>

    <ContentPage.Content>
        <StackLayout Margin="20">
            <ContentView HeightRequest="55">
                <Label  Text="Tabla de Amortización" FontSize="20" FontAttributes="Bold" HorizontalOptions="CenterAndExpand" HorizontalTextAlignment="Center" TextColor="Black"/>
            </ContentView>
            <ContentView>
                <Label x:Name="Prestamolbl" Text="{Binding DescripcionPrestamo}" TextColor="Black" FontSize="16" FontAttributes="Bold" HorizontalOptions="CenterAndExpand" HorizontalTextAlignment="Center"></Label>
            </ContentView>

            <ContentView>
                <Label x:Name="lblTotalCapital" TextColor="Black" FontSize="14" Text="{Binding STotalCapital}"   FontAttributes="Bold" HorizontalOptions="CenterAndExpand" HorizontalTextAlignment="Center"></Label>
            </ContentView>
            <ContentView>
                <Label x:Name="lblTasaInteres"  Text="{Binding TasaInteresTexto}" TextColor="Black" FontSize="14" FontAttributes="Bold" HorizontalOptions="CenterAndExpand" HorizontalTextAlignment="Center"></Label>
            </ContentView>
            <ContentView>
                <Label x:Name="lblPagoMensual" Text="{Binding PagoMensualCapital}"  TextColor="Black" FontSize="14"   FontAttributes="Bold" HorizontalOptions="CenterAndExpand" HorizontalTextAlignment="Center"></Label>
            </ContentView>

            <ContentView>
                <Grid Padding="5" ColumnSpacing="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <!-- Fecha Pago -->
                        <ColumnDefinition Width="*"/>
                        <!-- Saldo Insoluto -->
                        <ColumnDefinition Width="*"/>
                        <!-- Pago Periódico -->
                        <ColumnDefinition Width="*"/>
                        <!-- Interés -->
                        <ColumnDefinition Width="*"/>
                        <!-- IVA -->
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Label FontSize="12" Text="Fecha Pago"
               Grid.Column="0" FontAttributes="Bold"
               HorizontalTextAlignment="Center" TextColor="Black"
               IsVisible="{Binding BindingContext.MostrarFechaPago, Source={x:Reference LstTablaAmortizacionPrestamo}}"/>

                    <Label FontSize="12" Text="Saldo Insoluto" Grid.Column="1" FontAttributes="Bold" HorizontalTextAlignment="Center" TextColor="Black"/>
                    <Label FontSize="12" Text="Pago Periódico" Grid.Column="2" FontAttributes="Bold" HorizontalTextAlignment="Center" TextColor="Black"/>
                    <Label FontSize="12" Text="Interés"        Grid.Column="3" FontAttributes="Bold" HorizontalTextAlignment="Center" TextColor="Black"/>
                    <Label FontSize="12" Text="IVA"            Grid.Column="4" FontAttributes="Bold" HorizontalTextAlignment="Center" TextColor="Black"/>
                </Grid>
            </ContentView>


            <CollectionView
    ItemsSource="{Binding TablaAmortizacionPrestamo}"
    x:Name="LstTablaAmortizacionPrestamo"
    SelectionMode="None"
    ItemsLayout="VerticalList"
    VerticalOptions="FillAndExpand"
    HorizontalOptions="FillAndExpand"
    ItemSizingStrategy="MeasureAllItems">

                <CollectionView.EmptyView>
                    <Label Text="Sin registros" HorizontalOptions="Center" VerticalOptions="Center" />
                </CollectionView.EmptyView>

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid Padding="5" ColumnSpacing="10">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="40" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <!-- Fecha Pago -->
                                <ColumnDefinition Width="*"/>
                                <!-- Saldo Insoluto -->
                                <ColumnDefinition Width="*"/>
                                <!-- Pago Periódico -->
                                <ColumnDefinition Width="*"/>
                                <!-- Interés -->
                                <ColumnDefinition Width="*"/>
                                <!-- IVA -->
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                           

                            <Label Text="{Binding FechaPago}"      Grid.Column="0" FontSize="13" TextColor="Black" HorizontalTextAlignment="Center" VerticalTextAlignment="Center"/>
                            <Label Text="{Binding SaldoInsoluto}"  Grid.Column="1" FontSize="13" TextColor="Black" HorizontalTextAlignment="Center" VerticalTextAlignment="Center"/>
                            <Label Text="{Binding PagoMensual}"    Grid.Column="2" FontSize="13" TextColor="Black" HorizontalTextAlignment="Center" VerticalTextAlignment="Center"/>
                            <Label Text="{Binding Intereses}"      Grid.Column="3" FontSize="13" TextColor="Black" HorizontalTextAlignment="Center" VerticalTextAlignment="Center"/>
                            <Label Text="{Binding IVA}"            Grid.Column="4" FontSize="13" TextColor="Black" HorizontalTextAlignment="Center" VerticalTextAlignment="Center"/>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>

            </CollectionView>



            <ContentView>
                <Grid Padding="5" ColumnSpacing="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <!-- Totales: -->
                        <ColumnDefinition Width="*"/>
                        <!-- Total Pago Periódico -->
                        <ColumnDefinition Width="*"/>
                        <!-- Total Intereses -->
                        <ColumnDefinition Width="*"/>
                        <!-- Total IVA -->
                        <ColumnDefinition Width="*"/>
                        <!-- Total de pagos -->
                    </Grid.ColumnDefinitions>

                    <Label FontAttributes="Bold" FontSize="13" TextColor="Black" Text="Totales:" Grid.Column="0" HorizontalTextAlignment="Center"/>

                    <Label FontAttributes="Bold" FontSize="13" TextColor="Black" Text="{Binding STotalPagos}"       Grid.Column="1" HorizontalTextAlignment="Center"/>
                    <Label FontAttributes="Bold" FontSize="13" TextColor="Black" Text="{Binding STotalPagoMensual}" Grid.Column="2" HorizontalTextAlignment="Center"/>
                    <Label FontAttributes="Bold" FontSize="13" TextColor="Black" Text="{Binding STotalIntereses}"   Grid.Column="3" HorizontalTextAlignment="Center"/>
                    <Label FontAttributes="Bold" FontSize="13" TextColor="Black" Text="{Binding STotalIva}"         Grid.Column="4" HorizontalTextAlignment="Center"/>
                </Grid>
            </ContentView>


            <Label Padding="0, 20, 0, 20" FontSize="13" Text="El cálculo de importes y plazo mostrados son solo como referencia y para fines informativos." Grid.Row="0" Grid.Column="0" FontAttributes="Bold" HorizontalOptions="FillAndExpand" ></Label>
            <Button x:Name="RegresarBtn" Text="Aceptar" ImageSource="btnRegresar"
                        Clicked="RegresarBtn_Clicked" Style="{DynamicResource btnDark}" />
        </StackLayout>
    </ContentPage.Content>
</ContentPage>


